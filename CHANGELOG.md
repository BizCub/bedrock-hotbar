* Now the actionbar is also offset along with other elements.
* As much duplicate code as possible has been removed.